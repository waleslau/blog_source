---
layout: post
title: ä½¿ç”¨ davfs2 æŒ‚è½½ webdav
abbrlink: a7b61f3fa1934555a3a519c34a61cd75
tags:
  - linux
  - webdav
categories:
  - ğŸ“æŠ€æœ¯æ‚è°ˆ
date: 1659787200000
updated: 1671453600000
---
é¦–å…ˆå®‰è£…å¥½ davfs2 è½¯ä»¶åŒ…

## é…ç½® davfs2

* ç¼–è¾‘ /etc/davfs2/davfs2.conf å–æ¶ˆä»¥ä¸‹é¡¹çš„æ³¨é‡Šå¹¶æ›´æ”¹å€¼

```bash
ignore_dav_header 1
use_locks 0
```

* é…ç½®ç”¨æˆ·å/å¯†ç 

ç¼–è¾‘ /etc/davfs2/secrets æœ«å°¾æ·»åŠ 

```bash
https://seto.teracloud.jp/dav/ <username> <secret>
# ä¹Ÿå¯ä»¥æœ‰å­ç›®å½•
https://seto.teracloud.jp/dav/dir1/ <username> <secret>
https://seto.teracloud.jp/dav/dir2/ <username> <secret>
```

## æ‰‹åŠ¨æŒ‚è½½

```bash
#åˆ›å»ºæŒ‚è½½è·¯å¾„
mkdir /webdav
#æ‰‹åŠ¨æŒ‚è½½
mount -t davfs https://seto.teracloud.jp/dav/dir1/ /webdav/dir1/
# å¸è½½
umount /webdav/dir1/
```

æ‰‹åŠ¨æŒ‚è½½æµ‹è¯•è¿‡æ²¡é—®é¢˜åå¯ä»¥é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½

## è‡ªåŠ¨æŒ‚è½½

ç¼–è¾‘ /etc/fstab æœ«å°¾æ·»åŠ 

```bash
https://seto.teracloud.jp/dav/dir1/ /path/to/dir1/ davfs rw,user,sync,noauto,uid=1000,_netdev 0 0
```

ç¼–è¾‘ `etc/systemd/system/mount-webdav.service`

```bash
[Unit]
# æœåŠ¡åç§°ï¼Œå¯è‡ªå®šä¹‰Description=Mount WebDAV Service (KeePass)
After = network.target syslog.target
Wants = network.target

[Service]
Type = oneshot
ExecStart = bash -c 'for i in {1..15}; do if ping -c 1 seto.teracloud.jp; then mount /path/to/dir1/; break; else sleep 1; fi; done'
ExecStop = umount /path/to/dir1/
RemainAfterExit = true

[Install]
WantedBy = multi-user.target
```

ç„¶åæ‰§è¡Œä¸‹é¢å‘½ä»¤

```bash
systemctl enable --now keepass-webdav.service
```
