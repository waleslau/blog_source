---
layout: post
title: åœ¨ Linux ç³»ç»Ÿç¡çœ /ä»Žç¡çœ å”¤é†’æ—¶è‡ªåŠ¨è¿è¡Œè„šæœ¬
abbrlink: 0c5706c741684e7388d0615ce28cb4c6
tags:
  - suspend
  - linux
  - systemd
categories:
  - ðŸ“Linux
date: 1650122340000
updated: 1650122340000
---
æˆ‘ç¬”è®°æœ¬ä¸Šè£…çš„ openSUSE Tumbleweed åœ¨ä»Žç¡çœ çŠ¶æ€æ¢å¤åŽï¼Œæ€»æ˜¯å‡ºçŽ°æ—¶é—´æ˜¾ç¤ºä¸æ­£å¸¸çš„æƒ…å†µï¼Œåˆæ­¥æŽ¨æµ‹å¯èƒ½ä¸Žç¡¬ä»¶æ—¶é’Ÿæœ‰å…³ã€‚

æœ¬å­ä¸Šç›®å‰æ˜¯ Linux/Windows åŒç³»ç»Ÿï¼Œå½“åˆè£…ç³»ç»Ÿæ—¶æˆ‘ä¸ºäº†ä¸å¯¹ Windows ç³»ç»Ÿäº§ç”Ÿå½±å“å°±æ²¡æœ‰è®¾ç½®ç¡¬ä»¶æ—¶é’Ÿä¸º UTC ~~å…¶å®žæ˜¯æ‡’å¾—åŽ» windows æ”¹~~ï¼Œä»¥å‰ä¹Ÿæ›¾ç”¨è¿‡ Manjaroã€Deepin ç­‰å…¶ä»–å‘è¡Œç‰ˆï¼Œä¹Ÿæ—¶å¸¸ä¼šå‡ºçŽ°è¿™ç§æƒ…å†µã€‚

æœ¬æ¥æˆ‘å¾ˆå°‘ç”¨ç¡çœ è¿™ä¸ªé€‰é¡¹ï¼Œå°±æ²¡å¤ªåœ¨æ„è¿™ä¸ªé—®é¢˜ï¼Œä½†çŽ°åœ¨æ—¶é—´æ€»ä¹±å°±ä¸èƒ½å¿äº†ï¼Œæœ‰æ²¡æœ‰åŠžæ³•å¯ä»¥ä¸æ”¹å…¶ä»–ä»»ä½•é…ç½®è¿˜èƒ½è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

ç ”ç©¶äº†ä¸€ä¸‹å‘çŽ°å¯ä»¥ä½¿ç”¨ sudo chronyc makestep æ‰‹åŠ¨æ ¡å‡†ï¼Œè¦æƒ³åœ¨åœ¨ä»Žç¡çœ æ¢å¤åŽè‡ªåŠ¨æ‰§è¡Œå®ƒ[^1]ï¼Œåˆ™å¯ä»¥åœ¨ `/usr/lib/systemd/system-sleep` ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ `chronyc.sleep`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```bash
#!/bin/sh
if [ "${1}" == "pre" ]; then
    # Do the thing you want before suspend here, e.g.:
    echo "we are suspending at $(date)..." > /tmp/systemd_sleep_log
elif [ "${1}" == "post" ]; then
    # Do the thing you want after resume here, e.g.:
    echo "...and we are back from $(date)" >> /tmp/systemd_sleep_log
    sleep 6 && chronyc makestep &>> /tmp/systemd_sleep_log
fi
```

ç¡çœ å¹¶å”¤é†’åŽæŸ¥çœ‹ `/tmp/systemd_sleep_log`

```bash
idea@wei-laptop:~> cat /tmp/systemd_suspend_test
we are suspending at 2022å¹´ 04æœˆ 16æ—¥ æ˜ŸæœŸå…­ 23:03:53 CST...
...and we are back from 2022å¹´ 04æœˆ 16æ—¥ æ˜ŸæœŸå…­ 23:03:58 CST
200 OK
```

It Works!

[^1]: [Running scripts before and after suspend with systemd](https://blog.christophersmart.com/2016/05/11/running-scripts-before-and-after-suspend-with-systemd/)
